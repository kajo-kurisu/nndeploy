# Product Requirements Document

## 推理部署的节点编辑工具产品需求文档

###  一、菜单栏

####  （一）文件

**新建工作流**

需求：用户点击后，创建一个全新的空白工作流页面，旧的页面依旧保留，采用多标签页设计。用户可以同时编辑多个工作流，便于项目对比和管理。

原型设计：在"文件"下拉菜单中，"新建工作流"选项以清晰的文字显示。点击后立即创建新标签页，并自动切换到该标签页。

样式：采用简约风格，菜单项使用深色文字配合浅色背景，鼠标悬停时呈现轻微的高亮效果，使用与dify一致的蓝色(#2970FF)作为主色调。新标签页创建时有平滑的过渡动画。

快捷键：Ctrl + N

**打开工作流**

需求：弹出文件选择窗口，支持工作流文件格式（格式为.json），加载选中的工作流到当前编辑界面。支持从最近打开的文件列表中快速选择。

原型设计：下拉菜单中对应选项，点击后显示文件浏览器，文件列表展示文件名称、创建时间、文件大小等信息。文件浏览器顶部显示"最近打开"区域，列出最近使用过的工作流文件。

样式：文件浏览器采用简洁布局，每个文件以列表形式展示，包含文件名、创建日期，支持列表视图切换，与dify的文件选择界面保持一致的设计语言。最近文件区域使用列表式设计，显示文件名和上次打开时间。

快捷键：Ctrl + O

**保存工作流**

需求：将当前编辑的工作流以.json格式保存到原路径或默认路径，若为新建工作流则弹出保存路径选择窗口。保存操作会记录工作流的所有节点、连接和配置信息。

原型设计：菜单选项可实时更新保存状态（如保存成功后变为灰色不可选，待修改后再次变为可选），保存过程中显示进度条。保存完成后在状态栏显示保存成功提示和时间戳。

样式：保存按钮使用dify特有的蓝色(#2970FF)，保存状态通过变化直观表示，保存进度条采用细长设计（高度4px），颜色从左到右渐变，提供平滑的视觉体验。保存成功提示使用绿色(#4CAF50)，简短显示后自动消失。

快捷键：Ctrl + S

**另存为**

需求：允许用户选择保存路径和文件名，以另存当前工作流，不覆盖原文件。可用于创建工作流的不同版本或备份。

原型设计：弹出保存对话框，包含路径选择栏、文件名输入框，默认文件名根据当前工作流内容自动生成，用户可修改。对话框底部显示可用空间信息和文件格式选项。

样式：保存对话框采用圆角设计（半径8px），输入框和按钮保持一致的视觉风格，主操作按钮使用填充色(#2970FF)，次要操作使用描边样式，符合dify的设计规范。文件名输入框提供实时验证，无效字符自动标红提示。

快捷键：Ctrl + Shift + S

**导出工作流**

需求：支持导出为多种格式，包括图片格式（PNG、JPEG等用于展示）和JSON格式（用于保存工作流）。图片导出可用于文档和演示，JSON导出用于工作流共享和版本控制。

原型设计：导出选项下有格式子菜单，每种格式有简要说明，选择格式后弹出对应配置窗口（如图片导出的分辨率设置等）。导出过程显示进度条，完成后提供预览和打开文件位置选项。

样式：子菜单采用级联式设计，配置窗口采用分组表单布局，参数调整区域提供实时预览，整体风格简洁现代。导出完成后的成功提示使用轻量级通知，右下角显示3秒后自动消失。

**导入工作流**

需求：识别并导入外部工作流文件，可对导入文件进行兼容性检查，若不兼容给出提示。支持导入comfyui的工作流文件，实现跨平台工作流复用。

原型设计：点击后弹出文件选择窗口，导入成功后工作流自动加载到画布，同时显示导入报告（如导入的节点数量、连线数量等）。对于不兼容的节点或连接，提供详细的错误信息和可能的解决方案。

样式：导入过程中显示动态加载动画，采用dify的圆形进度指示器，导入报告以简洁形式弹出，成功状态使用绿色(#4CAF50)，警告使用黄色(#FFC107)，错误使用红色(#F44336)，保持视觉一致性。不兼容项目以列表形式展示，每项可展开查看详情。

####  （二）编辑

**撤销 / 重做**

需求：支持多次撤销和重做操作，记录用户的操作历史，包括节点的添加、删除、移动、属性修改，连线的创建、删除等操作。撤销和重做操作可以帮助用户纠正错误或尝试不同的设计方案。

原型设计：在菜单中以"撤销（Ctrl+Z）""重做（Ctrl+Y）"显示，同时在编辑区域附近设置撤销/重做按钮，按钮样式直观，鼠标悬停显示操作历史详情。操作历史面板可展开查看完整历史记录，并支持跳转到特定状态。

样式：撤销/重做按钮放置在工具栏左侧，与dify的工具栏布局一致，悬停提示采用浮动样式，显示最近的5条操作记录。操作历史面板使用时间线形式展示，当前状态用蓝色标记(#2970FF)，可撤销操作用灰色标记(#9E9E9E)，可重做操作用虚线标记。

**复制 / 粘贴**

需求：允许用户复制单个或多个节点及其连接关系，粘贴到画布的指定位置，粘贴时自动调整节点位置避免重叠。复制粘贴功能可用于快速复制常用节点组合或在不同工作流间共享节点配置。

原型设计：支持快捷键（Ctrl+C/Ctrl+V），在菜单中有对应选项，选中节点后右键菜单也有复制/粘贴选项，复制的节点以半透明状态显示，提示用户即将粘贴的位置。粘贴时保持节点间的相对位置和连接关系，但自动避开已有节点。

样式：右键菜单采用简洁设计，菜单项左侧显示文字，右侧显示快捷键，选中效果为轻微背景色变化，复制预览节点使用40%透明度，边缘有虚线描边（2px宽，#2970FF颜色），符合dify的交互设计语言。粘贴操作完成后，新节点有短暂的高亮效果（持续0.5秒），帮助用户识别。

**对齐工具**

需求：提供多种对齐方式，包括左对齐、右对齐、水平居中对齐、顶对齐、底对齐、垂直居中对齐等，可同时对多个节点进行对齐操作。对齐工具帮助用户创建整齐、专业的工作流布局，提高可读性。

原型设计：在菜单中打开对齐工具子菜单，每种对齐方式有对应文字说明，选中多个节点后，对齐选项变为可用状态，操作后节点自动按所选方式对齐。对齐操作可撤销，对齐前后有动画过渡效果。

样式：对齐工具排列成工具栏，可在选中多个节点时自动显示在画布上方，颜色与dify的蓝色系统(#2970FF)保持一致，提供即时的视觉反馈。每种对齐方式有对应的文字说明，鼠标悬停时显示示意图，操作时有平滑的动画效果（持续300ms）。

####  （三）设置

**主题设置**

需求：提供多种主题选择，包括浅色主题、深色主题和系统自动主题，允许用户自定义主题色彩，调整界面元素的颜色、对比度和字体大小。主题设置可根据用户偏好和工作环境（如弱光环境下使用深色主题）提高使用舒适度。

原型设计：在设置窗口中有"主题设置"分组，提供主题模式切换按钮（浅色/深色/跟随系统），主题色选择器，以及字体大小调整选项（12px-18px），所有设置实时预览效果。主题设置自动保存，下次启动时自动应用。

样式：主题设置区域采用简洁布局，主题模式切换使用分段控制器，主题色选择提供预设色板和自定义色彩选项，字体大小调整使用带标记的滑块，整体设计与dify的设置界面风格保持一致，提供平滑的过渡动画（300ms）。主题切换时，所有界面元素平滑过渡，不产生闪烁。

**语言设置**

需求：支持多种语言选择，包括中文、英文等，允许用户切换界面语言。语言设置可满足不同地区用户的使用需求，提高软件的国际化水平。

原型设计：在设置窗口中有"语言设置"分组，提供语言选择下拉框，设置后界面元素的文本内容自动更新。语言设置实时生效，无需重启应用。

样式：语言设置区域采用简洁布局，语言选择提供预设语言选项（中文、英文），与dify的设置界面风格保持一致，提供平滑的过渡动画（300ms）。语言切换时，界面文本平滑更新，保持布局稳定，不影响用户操作。

####  （四）帮助

**操作文档**

需求：提供详细的操作手册，以图文并茂的方式介绍工具的各个功能模块、操作步骤、常见问题解答等。操作文档帮助用户快速上手和解决使用过程中的问题，降低学习成本。

原型设计：点击后在新窗口或浏览器标签页中打开操作文档，文档有目录结构，方便用户快速定位到所需内容，可搜索关键词。文档包含基础教程、高级功能、最佳实践和常见问题解答等章节。

样式：文档页面采用响应式设计，左侧为固定的目录导航（宽度240px），右侧为内容区，配色方案与主应用保持一致，代码示例使用语法高亮，图片说明配有交互式放大功能。文档支持深浅色主题切换，打印友好，可导出为PDF格式。

**反馈与建议**

需求：用户可提交使用过程中的问题反馈和功能改进建议，提交内容包含用户邮箱（可选）、问题描述、截图（可选）等。反馈系统帮助开发团队收集用户意见，持续改进产品。

原型设计：在帮助菜单中有"反馈与建议"选项，点击后弹出反馈表单，包含文本输入框、截图上传按钮，提交成功后显示感谢信息。反馈表单支持选择反馈类型（问题报告、功能建议、其他），并可设置优先级。

样式：反馈表单采用浮动设计，输入框提供字数统计（最多1000字），截图上传区支持拖放操作，整体风格简洁友好，与dify的表单设计保持一致，提交按钮使用主题色(#2970FF)。提交成功后显示动画确认，并提供反馈跟踪号码。

**关于**

需求：显示工具的当前版本号、发布时间、更新日志等。关于页面提供软件的基本信息，帮助用户了解版本状态和更新内容。

原型设计：在帮助菜单中选择"关于"，弹出对话框显示版本号、发布时间，更新日志以列表形式展示，可展开查看详细内容。关于页面还包含开发团队信息、许可协议和第三方组件致谢。

样式：版本信息对话框采用简约设计，顶部显示应用logo和版本号，更新日志使用时间线形式展示，重要更新用特殊标记突出，整体视觉风格与dify的信息展示一致。版本号使用大号字体，更新日志条目可点击展开查看详情。

###  二、侧边栏（宽度可调整，默认宽度240px）

####  （一）节点面板

**节点分类展示**

需求：将节点按功能类型分类，如数据输入节点、数据处理节点、模型调用节点、输出展示节点、控制流节点（本地节点、远程节点、api节点）等，每个分类可展开和收起。分类展示帮助用户快速找到所需节点类型，提高工作效率。

原型设计：节点面板以树形结构展示分类，每个分类前有展开/收起标识，节点名称前有文字表示节点类型，鼠标悬停显示节点功能简介。分类可拖动调整顺序，常用节点可标记为收藏，显示在顶部区域。

样式：侧边栏采用与dify一致的设计，背景色为浅灰色(#F5F5F5)，分类标题使用粗体，展开/收起使用箭头标识，每类节点有独特的颜色编码，便于识别。收藏节点区域使用浅色背景分隔，展开/收起动画平滑（持续200ms），提供良好的视觉体验。

**节点搜索**

需求：提供搜索框，用户可输入关键词搜索节点，搜索结果实时显示在节点面板中。搜索功能帮助用户在大量节点中快速定位所需功能，支持模糊匹配和标签搜索。

原型设计：在节点面板顶部有搜索框，输入关键词时，节点列表自动筛选，匹配的节点以高亮显示。搜索支持节点名称、描述和标签，结果按相关性排序，可记住用户最近的搜索历史。

样式：搜索框采用圆角设计（半径4px），输入时显示清除按钮，搜索结果中关键词高亮显示，使用dify的主题蓝色(#2970FF)，无结果时显示友好的提示信息和建议。搜索历史以下拉列表形式显示，点击即可快速重复搜索，提高效率。

####  （二）模型面板

**本地模型列表展示**

需求：展示指定目录下的模型资源，包括模型名称、类型、大小、上次使用时间等信息，支持按不同属性排序和筛选。模型列表帮助用户管理和选择适合的AI模型，提高工作流配置效率。

原型设计：模型面板以列表形式展示模型，每行显示一个模型的名称、类型文字、大小和状态标签，提供搜索框快速查找模型。列表支持按名称、大小、使用频率等属性排序，可按模型类型（如图像、文本、音频等）筛选。

样式：模型列表采用简洁设计，每个模型显示模型名称、已加载模型使用蓝色标签(#2970FF)标识，未加载模型使用灰色标签(#9E9E9E)，整体风格与dify的资源列表保持一致。排序和筛选控件位于列表顶部，操作简单直观，筛选状态有明确的视觉反馈。

**本地模型或模型目录的导入/接入**

需求：支持导入本地目录或本地模型文件，自动识别常见模型格式（如.onnx、.pt、.bin等），提供模型验证和基本信息提取功能，支持批量导入。模型导入功能使用户能够将自己的AI模型集成到工作流中，扩展工具的应用场景。

原型设计：在模型面板中有"添加模型"按钮，点击后弹出模型接入向导，可选择导入单个模型文件或整个模型目录，支持拖拽文件到指定区域，导入过程显示进度条和验证状态，成功后自动添加到模型列表。向导提供模型类型选择和基本参数配置，如输入输出格式、预处理要求等。

样式：添加按钮使用简洁设计，位于面板顶部，接入向导采用步骤式设计，每步骤有明确标题和说明，输入区域提供格式验证和自动完成功能，验证过程显示动态进度指示器，成功导入后有简短的成功动画反馈（持续1秒），整体风格简洁专业。错误提示清晰明确，提供解决建议。

####  （三）素材面板

**素材分类管理**

需求：对素材进行分类，如提示词模板、数据样本、文本模板、图像素材、音频素材等，方便用户查找和管理。分类管理帮助用户组织和访问各类资源，提高工作流配置效率。

原型设计：素材面板以分类标签形式展示，每个标签对应一个素材分类，点击标签切换分类内容，支持用户自定义分类和素材标签。分类支持嵌套结构，可创建子分类，素材可添加多个标签，便于多维度管理。

样式：分类标签采用水平滚动设计，当前选中标签底部有蓝色指示线（2px高，#2970FF颜色），与dify的标签设计一致，自定义分类功能通过添加按钮实现，标签编辑采用内联编辑模式，提供流畅的用户体验。标签颜色可自定义，帮助用户视觉区分不同类别。

**素材上传**

需求：允许用户上传本地素材到素材面板，支持多种文件格式（数据样本支持.csv、.xlsx等格式，图像支持.jpg、.png等格式，音频支持.mp3、.wav等格式）。上传功能使用户能够将自己的资源集成到工作流中，扩展工具的应用场景。

原型设计：在素材面板中有"上传素材"按钮，点击后弹出文件选择窗口，可选择多个文件上传，上传过程显示进度条，成功后素材添加到对应分类。上传支持批量操作，可设置文件重命名规则和自动分类规则，提高批量处理效率。

样式：上传区域支持拖放操作，上传过程显示环形进度指示器，文件类型错误时提供醒目但不刺眼的错误提示（红色#F44336），成功上传后有简短的成功动画（持续1秒），增强用户体验。批量上传时显示总进度和当前文件进度，提供取消选项。

**素材预览和使用**

需求：对于图像、音频等素材，提供预览功能，用户可将素材直接拖到画布中使用，用于与节点关联或作为节点输入。对于提示词模板，提供编辑和测试功能。预览功能帮助用户确认素材内容，拖放操作简化工作流配置过程。

原型设计：素材列表中，图像素材显示缩略图，音频素材有播放按钮可预览，提示词模板可点击编辑，鼠标长按素材可拖动到画布，拖动过程中显示半透明素材轮廓提示放置位置。预览窗口支持放大、缩小、旋转等操作，音频预览提供波形显示和播放控制。

样式：素材预览采用简洁布局，图片素材显示缩略图，音频素材显示波形，提示词模板显示文本预览（最多显示3行），鼠标悬停时显示操作选项，拖动时素材跟随鼠标移动，半透明效果（70%透明度）与dify的拖放交互一致。预览窗口使用浮层设计，背景半透明，不阻断工作流程。

###  三、画布组件

####  （一）网格背景

**网格显示与隐藏**

需求：用户可通过设置或快捷键切换网格的显示与隐藏状态。网格帮助用户对齐节点，创建整齐的工作流布局，但也可根据个人偏好隐藏，减少视觉干扰。

原型设计：在画布设置中可勾选"显示网格"选项，切换时画布实时更新显示效果。快捷键为Ctrl+G。网格设置包括网格大小、颜色和样式（点状、线状）选项，可根据用户偏好自定义。

样式：网格采用点阵式设计，点间距为20px，颜色为浅灰色(#E5E5E5)，与dify的画布背景协调，网格密度适中，不干扰视觉但提供足够的对齐参考，切换显示/隐藏时有淡入淡出效果（持续300ms）。自定义网格设置实时预览效果，提供直观的视觉反馈。

####  （二）缩放控制

**缩放操作方式**

需求：支持鼠标滚轮缩放、工具栏缩放按钮缩放、快捷键缩放，缩放范围可自定义。多种缩放方式满足不同用户的操作习惯，帮助用户查看工作流的整体结构或细节。

原型设计：在画布工具栏中有缩放"+""-"按钮，鼠标滚轮滚动时，画布以当前鼠标位置为中心进行缩放，缩放过程平滑过渡，显示当前缩放比例。快捷键为Ctrl+"+"和Ctrl+"-"。缩放控制还包括"适应画布"和"实际大小"按钮，一键调整视图。

样式：缩放控制位于画布右下角，采用半透明背景（80%透明度）的控制组，包含"-"、百分比显示、"+"三个元素，与dify的缩放控制一致，缩放过程动画平滑（持续200ms），提供流畅的视觉体验。缩放比例显示为百分比，字体清晰易读，缩放时数值平滑更新。

**缩放边界设置**

需求：设置最小缩放比例和最大缩放比例，防止过度缩放导致内容不可见或布局混乱。缩放边界保护用户体验，确保工作流始终可见和可操作。

原型设计：在画布设置中可设置"最小缩放比例"和"最大缩放比例"，默认最小缩放比例为0.2，最大缩放比例为5.0，超出范围禁止缩放并提示用户。设置可通过滑块或直接输入数值调整，实时生效。

样式：达到缩放边界时，缩放按钮变为禁用状态(灰色#9E9E9E)，同时显示简短的提示信息，使用轻量级的toast通知，位于画布底部，持续2秒，不干扰用户操作，设计风格与dify的通知系统一致。缩放边界设置使用双向滑块控件，直观显示可用范围。

####  （三）画布拖拽

**拖拽操作**

需求：用户可通过鼠标拖动画布，查看画布上超出显示区域的内容，拖动过程流畅。拖拽功能帮助用户浏览大型工作流，查看不同区域的节点和连接。

原型设计：按住鼠标中键或空格键+鼠标左键拖动画布时，画布跟随鼠标移动，可在画布边缘显示拖动方向提示，松开鼠标停止拖动。拖拽支持惯性滚动，快速拖动后画布会继续短暂移动并逐渐停止，提供自然的交互体验。

样式：拖拽时鼠标指针变为手形，画布移动有惯性效果（200ms减速），提供自然的交互感受，边缘提示采用渐变设计（从透明到半透明），颜色与dify的导航提示一致(#2970FF)，不干扰视觉但提供足够的方向指引。拖拽过程中，画布内容保持清晰，无模糊效果。

####  （四）节点放置

**节点放置操作**

需求：用户从侧边栏节点面板拖动节点到画布中，节点放置位置准确。节点放置是工作流构建的基本操作，需要直观、精确的交互体验。

原型设计：拖动节点到画布时，显示节点名称，放置成功后节点以默认样式显示。

样式：拖动过程中节点呈半透明状态(70%透明度)，放置区域显示蓝色虚线框（2px宽，#2970FF颜色），成功放置后有轻微的"落地"动画（持续300ms），增强用户体验，整体视觉风格与dify的节点拖放一致。

**节点重叠处理**

需求：当多个节点放置在同一位置时，提供节点重叠处理方式，如自动分层显示。

原型设计：若节点重叠，重叠的节点以不同透明度显示，提示用户可通过拖动或对齐工具调整位置，也可在设置中选择自动分层显示模式，重叠节点自动分层排列（垂直间距20px）。

样式：重叠节点以堆叠方式显示，边缘有微小错位（5px），创造纸张堆叠的视觉效果，顶部节点完全不透明，下方节点逐渐增加透明度（每层增加20%），重叠警告使用黄色提示(#FFC107)，与dify的警告提示保持一致。

###  四、节点组件

####  （一）类型

**多种节点类型支持**

需求：提供丰富的节点类型，满足AI推理部署的不同业务场景需求，如：
- 输入节点（文本输入、图像、音频、视频、文件等）：用于接收用户输入的各种数据类型
- 前处理节点（cv类的前处理节点和nlp类的前处理节点）：对输入数据进行预处理，如图像缩放、文本分词等
- 推理节点（调用推理框架推理）：执行AI模型推理，处理输入数据并生成输出结果
- 后处理节点（文本、图像、音频、视频、文件等）：对模型输出进行后处理，如结果格式化、数据转换等
- 输出展示节点（图片、视频、音频、文本、表格等）：将处理结果以可视化方式展示给用户
- 控制流节点（条件判断、循环、分支、合并等）：控制工作流执行路径，实现复杂的业务逻辑

原型设计：每个节点有唯一标识符，采用与dify一致的颜色编码系统，节点形状和大小根据类型和功能有所区别，便于用户快速识别。

样式：节点采用圆角矩形设计（半径8px），左侧有5px宽的类型标识色条，与dify保持一致，节点内部采用简洁布局，标题粗体显示。

####  （二）输入

**输入端口定义**

需求：每个节点可定义多个输入端口，端口有名称、数据类型（cv::Mat、tensor、numpy.array、list、dict、str、int、float、bool）。

原型设计：在节点配置面板中，有"输入端口"设置区域，以表格形式展示输入端口信息，可添加、删除、修改端口属性，端口名称和数据类型有下拉选择框，可选性通过勾选框设置，默认值可直接输入或从素材库选择。

样式：输入端口位于节点左侧，采用半圆形设计（半径6px），颜色根据数据类型区分（每个类型随机确定一种颜色），与dify的端口设计一致，端口悬停时显示数据类型和说明，连接状态有不同的视觉效果。

**输入数据验证**

需求：对输入到节点的数据进行类型验证、格式验证和业务规则验证，若数据不符合要求，提供详细的错误信息和修复建议。

原型设计：当数据通过连线或手动输入到节点时，实时进行验证，若验证失败，输入端口边框以红色闪烁提示（闪烁频率1Hz），鼠标悬停显示详细错误信息和修复建议，如"数据类型不匹配，应为数值类型，当前为文本类型，请添加类型转换节点"。

####  （三）输出

**输出端口定义**

需求：每个节点可定义多个输出端口，端口有名称、数据类型等属性，输出端口的数据类型根据节点处理逻辑自动确定或由用户手动设置。

原型设计：在节点配置面板中，有"输出端口"设置区域，以表格形式展示输出端口信息，可添加、删除、修改端口属性，数据类型根据节点处理逻辑有默认值，用户可修改。对于AI模型节点，自动显示模型可能的输出类型（如文本、图像等）。

**输出数据映射**

需求：支持将节点的输出数据映射到其他节点的输入端口，映射过程可进行数据转换（如数据格式转换、数据筛选等）。对于AI模型输出，提供结构化解析选项，将非结构化输出转换为结构化数据。

原型设计：在连线操作时，若源节点输出端口与目标节点输入端口数据类型不完全匹配，弹出数据映射设置窗口，用户可选择数据转换规则（如文本转数值、JSON解析、提取特定字段等），设置完成后连线成功建立，显示映射关系。对于AI模型输出，提供预设的解析模板。

####  （四）点击节点后，在右侧显示节点配置面板

**配置面板布局**

需求：节点配置面板分为多个区域，如基本信息区域（显示节点名称、类型、描述）、输入端口设置区域、输出端口设置区域、参数设置区域（根据节点类型而定，如AI模型节点的模型参数设置）、高级设置区域（如节点执行优先级、资源占用设置、错误处理策略等）。

原型设计：配置面板以选项卡形式展示不同区域内容，每个选项卡有清晰的标题和图标，基本信息区域在最前面，以表单形式显示节点名称、类型等信息，其他区域根据节点类型动态加载相应配置项，界面布局简洁明了，重要参数有详细说明和示例。

**配置实时生效**

需求：用户在节点配置面板中修改的设置实时生效，画布中的节点和相关连接根据设置更新显示和行为。提供配置预览功能，用户可在不执行整个工作流的情况下，预览单个节点的配置效果。

原型设计：用户修改配置后，无需额外保存操作，画布中的节点样式（如颜色、形状根据类型设置）、输入输出端口状态（如是否可选、数据类型显示）、执行逻辑（如参数修改后节点处理方式改变）等立即更新，有动画效果过渡。对于AI模型节点，提供 "测试" 按钮，点击后使用当前配置执行单节点测试，显示输出结果。

####  （五）拖动节点到画布中

**拖动操作流程**

需求：用户从侧边栏节点面板中选择节点，按住鼠标左键拖动到画布，拖动过程中显示节点的预览信息，放置成功后节点添加到画布并可进行后续操作。

原型设计：在节点面板中鼠标左键点击节点后，节点以半透明状态跟随鼠标移动，显示节点名称、功能简介等信息，拖动到画布合适位置松开鼠标，节点添加到画布，有轻微动画效果表示添加成功。

####  （六）节点连线

**连线操作流程**

需求：用户可通过多种方式创建节点间的连线：
1. 从源节点的输出端口拖动到目标节点的输入端口：用户点击源节点的输出端口并拖动到目标节点的输入端口，释放鼠标完成连接
2. 选择源节点和目标节点，自动创建连线：用户先后选中源节点和目标节点，系统自动分析可连接的端口并建立连接

连线过程中显示连线预览和数据流向，连线成功后节点之间建立数据传递关系。

原型设计：在画布中，节点的输入输出端口有明显的视觉标识（不同形状或颜色），鼠标悬停在端口上时，端口高亮显示并显示端口名称和数据类型。从输出端口拖动连线时，显示可连接的输入端口高亮提示，连线以曲线形式显示，箭头表示数据流向。

**连线类型**

需求：支持多种连线类型，以表示不同的数据流关系：
1. 标准数据流连线 - 表示常规数据传递：普通的数据传输，从一个节点到另一个节点
2. 条件连线 - 表示基于条件的数据流，如IF-THEN分支：只有在特定条件满足时才传递数据
3. 循环连线 - 表示循环处理的数据流：数据在特定条件下重复处理
4. 异步连线 - 表示异步处理的数据流：数据传递不阻塞工作流执行

连线类型根据源节点和目标节点的类型自动推荐，也可由用户手动设置。

原型设计：不同类型的连线以不同的线条样式和颜色显示（如标准连线为实线，条件连线为虚线，循环连线为点划线等），连线上可显示标签说明连线类型和条件。创建连线时，系统根据节点类型自动推荐连线类型，用户可在右键菜单中修改连线类型。

**连线验证**

需求：在创建连线时进行数据类型兼容性验证，确保源节点输出的数据类型与目标节点输入的数据类型兼容。若不兼容，提供详细的错误信息和解决方案建议（如添加数据转换节点）。

原型设计：创建连线时，系统自动检查数据类型兼容性，若兼容，连线以绿色显示并成功创建；若不兼容但可通过简单转换解决，连线以黄色显示并提示用户是否添加自动转换；若完全不兼容，连线以红色显示并提示错误原因，同时推荐可用的数据转换节点。

###  五、节点右击

####  （一）节点上下文菜单

**基本操作**

需求：在节点上右击时，显示上下文菜单，提供以下基本操作：
1. 删除节点 - 从画布中移除该节点及其相关连线：完全删除节点及其所有连接
2. 复制节点 - 创建当前节点的副本，包括其配置：复制节点的所有属性和设置到新节点
3. 重命名 - 修改节点显示名称：更改节点在画布上显示的名称
4. 单独执行 - 仅执行该节点及其依赖节点：只运行选中节点及其输入所需的上游节点
5. 添加注释 - 为节点添加说明文字，显示在节点旁边：添加辅助说明信息
6. 导出节点 - 将节点配置导出为JSON或其他格式：保存节点配置为文件
7. 设置节点样式 - 自定义节点的颜色、形状、大小等视觉属性：修改节点外观
8. 创建组 - 将该节点与其他选中节点组合为一个组：将多个相关节点组合为一个整体

原型设计：上下文菜单以弹出窗口形式显示，菜单项带有图标和快捷键提示，常用操作（如删除、复制）位于菜单顶部，不常用操作位于底部，危险操作（如删除）需要确认。


###  六、工作流执行与调试

####  （一）执行控制

**执行模式**

需求：提供多种工作流执行模式：
1. 执行 - 从起始节点开始执行整个工作流：按照节点间的连接关系顺序执行所有节点
2. batch - 执行的batch数量：设置批处理模式下的数据批次数量
3. 重置 - 重置工作流到初始状态：清除所有节点的执行状态和中间结果，恢复到未执行状态


**执行状态可视化**

需求：在工作流执行过程中，直观显示各节点的执行状态：
1. 待执行 - 节点尚未开始执行(待执行为灰色)：节点等待上游节点完成后执行
2. 执行中 - 节点正在执行(执行中为蓝色并显示进度动画)：节点正在处理数据
3. 执行成功 - 节点执行完成且成功（成功为绿色）：节点已完成数据处理且无错误
4. 执行失败 - 节点执行出错（失败为红色）：节点处理数据时遇到错误
5. 已跳过 - 由于条件不满足而跳过执行（下划线灰色）：条件判断导致节点不需执行

原型设计：节点下划线以不同的颜色表示不同的执行状态（待执行为灰色，执行中为蓝色并显示进度动画，成功为绿色，失败为红色等）。连线上显示数据流动的动画效果，表示数据传递过程。


## 目录结构及功能说明

ui/
├── app.py         # 应用程序入口点，负责初始化和启动整个应用
│                  # 功能：创建主窗口，加载配置，初始化各个模块，处理应用生命周期
│                  # 设计：采用单例模式，统一管理应用状态，提供全局访问点
├── config/                 # 配置文件目录，存放全局配置
│   ├── settings.py（基本完成）         # 全局设置，包括默认参数、路径配置等
│   │                       # 功能：管理应用全局参数，如工作目录、自动保存间隔、性能设置等
│   │                       # 原型设计：以字典或类形式定义全局参数，自动保存间隔等
│   ├── theme.py （基本完成）           # 主题配置，定义UI颜色、字体、样式等
│   │                       # 功能：提供统一的主题管理，支持明暗主题切换，确保UI风格一致性
│   │                       # 原型设计：定义主色调（采用dify的蓝色系）、次要色、背景色、字体等
│   │                       # 样式：支持明暗两套主题，颜色采用变量定义，便于全局统一修改
│   ├── language.py （语言未丰富）        # 语言配置，支持中英文一键切换
│   │                       # 功能：实现应用的国际化，管理所有UI文本的多语言版本
│   │                       # 原型设计：以字典形式定义所有UI文本的中英文对照，支持动态切换
│   │                       # 样式：在UI右上角提供语言切换按钮，切换时平滑过渡
│   └── shortcuts.py （快捷键未测试，快捷键也未丰富）       # 快捷键配置，定义所有操作的快捷键映射
│                           # 功能：管理全局快捷键，提供自定义快捷键功能，处理快捷键冲突
│                           # 原型设计：以字典形式定义操作与快捷键的映射关系，支持自定义修改
│                           # 样式：在UI中以表格形式展示，支持搜索和修改功能
├── assets/                 # 静态资源目录
│   ├── icons/              # 图标资源，用于界面各处的图标显示
│   │                       # 功能：提供应用所需的各类图标，确保视觉一致性
│   │                       # 原型设计：采用SVG格式图标，支持不同尺寸和颜色变化
│   │                       # 样式：线性设计风格，与dify保持一致的简约现代风格
│   ├── font/               # 字体
│   │                       # 功能：提供应用使用的字体文件，确保跨平台显示一致性
│   │                       # 设计：包含常规、粗体、斜体等变体，支持多语言字符集
│   ├── images/             # 图片资源，用于背景、示例图等
│   │                       # 功能：存储应用中使用的各类图片资源，如背景、示例、教程图等
│   │                       # 原型设计：高质量图片资源，支持不同分辨率设备
│   │                       # 样式：风格统一，配色与主题一致，提供视觉美感
│   └── templates/          # 预设工作流模板，用户可快速创建常用工作流
│                           # 功能：提供预定义的工作流模板，帮助用户快速开始项目
│                           # 原型设计：JSON格式工作流定义，包含节点布局和连接关系
│   └── locales/          # 语言
├── view/                   # 用户界面组件目录
│   ├── menu/               # 菜单栏组件，位于应用顶部
│   │   ├── file_menu.py    # 文件菜单，位于菜单栏左侧，提供文件操作功能
│   │   │                   # 功能：提供新建、打开、保存、导出等文件操作，管理工作流文件
│   │   │                   # 原型设计：下拉式菜单，包含新建、打开、保存等选项，每项右侧显示快捷键
│   │   │                   # 样式：菜单项使用深色文字配合浅色背景，鼠标悬停时呈现轻微高亮效果
│   │   ├── edit_menu.py    # 编辑菜单，位于文件菜单右侧，提供编辑操作
│   │   │                   # 功能：提供撤销、重做、复制、粘贴、删除等编辑功能
│   │   │                   # 原型设计：包含撤销、重做、复制、粘贴等选项，状态根据当前操作自动更新
│   │   │                   # 样式：不可用选项显示为灰色，当前可执行操作高亮显示
│   │   ├── settings_menu.py  # 设置菜单，位于编辑菜单右侧，提供应用配置选项
│   │   │                   # 功能：提供应用设置入口，包括主题、语言、性能等配置项
│   │   │                   # 原型设计：包含语言切换、theme切换等子菜单点击后打开对应设置面板
│   │   │                   # 样式：子菜单采用级联式设计，每种设置旁配有对应的小图标
│   │   └── help_menu.py    # 帮助菜单，位于菜单栏最右侧，提供帮助和支持信息
│   │   │                   # 功能：提供用户手册、教程、关于信息、反馈渠道等支持资源
│   │   │                   # 原型设计：包含操作文档、反馈与建议等选项，点击后打开相应页面
│   │   │                   # 样式：帮助图标采用问号设计，菜单项简洁明了
│   │   └── menu.py         # 菜单总览
│   │                       # 功能：整合所有菜单组件，管理菜单栏的整体布局和交互
│   │                       # 设计：提供统一的菜单注册和管理机制，处理菜单间的协调
├── panel/                  # 侧边栏组件，位于应用左侧
│   │   ├── node_panel.py   # 节点面板，侧边栏顶部标签页，展示可用节点
│   │   │                   # 功能：显示所有可用节点类型，支持拖拽到画布创建节点
│   │   │                   # 原型设计：节点以卡片形式展示，分类折叠展开，支持搜索和筛选
│   │   │                   # 样式：节点卡片包含图标、名称和简短描述，鼠标悬停时显示详细信息
│   │   ├── model_panel.py  # 模型面板，侧边栏中部标签页，管理模型资源
│   │   │                   # 功能：管理AI模型资源，支持导入、删除、更新模型
│   │   │                   # 原型设计：模型资源列表，显示模型名称、版本、大小等信息，支持导入和管理
│   │   │                   # 样式：模型卡片显示模型类型图标，状态标签用不同颜色区分（已加载、未加载等）
│   │   ├── material_panel.py  # 素材面板，侧边栏底部标签页，管理素材资源
│   │   │                   # 功能：管理图片、音频、视频等素材资源，支持预览和使用
│   │   │                   # 原型设计：素材资源网格视图，支持缩略图预览，拖拽到画布使用
│   │   │                   # 样式：素材卡片显示缩略图，支持列表视图和网格视图切换
│   │   └── workflow_panel.py  # 工作流面板，侧边栏底部标签页，管理工作流资源
│   │   │                   # 功能：管理已保存的工作流，支持预览、加载、编辑工作流
│   │   │                   # 原型设计：工作流资源列表，显示工作流名称、版本、大小等信息，支持导入和管理
│   │   │                   # 样式：工作流卡片显示工作流类型图标，状态标签用不同颜色区分（已加载、未加载等）
│   │   ├── panel.py        # panel总览
│   │                       # 功能：整合所有面板组件，管理侧边栏的整体布局和交互
│   │                       # 设计：实现标签页切换逻辑，处理面板的折叠/展开状态
│   ├── canvas/             # 画布组件，位于应用中央主区域
│   │   ├── grid.py         # 网格背景，画布底层显示的网格线
│   │   │                   # 功能：提供视觉参考网格，辅助节点对齐和布局
│   │   │                   # 原型设计：可调整网格大小和显示样式，支持对齐到网格功能
│   │   │                   # 样式：网格线采用浅灰色细线，可调整透明度，支持显示/隐藏切换
│   │   ├── zoom.py         # 缩放控制，位于画布右下角，控制画布缩放
│   │   │                   # 功能：提供画布缩放功能，支持精确缩放级别控制
│   │   │                   # 原型设计：包含放大、缩小按钮和百分比显示，支持鼠标滚轮缩放
│   │   │                   # 样式：缩放控件采用半透明设计，不干扰画布内容，鼠标悬停时完全显示
│   │   ├── drag.py         # 画布拖拽，实现画布的平移功能
│   │   │                   # 功能：允许用户平移画布视图，查看工作流的不同部分
│   │   │                   # 原型设计：按住空格键+鼠标拖动或中键拖动实现画布平移
│   │   │                   # 样式：拖动时鼠标指针变为手形，有平滑的动画效果
│   │   ├── selection.py    # 选择工具，实现节点和连线的选择功能
│   │   │                   # 功能：提供单选、多选、框选等选择操作，支持对选中元素的批量操作
│   │   │                   # 原型设计：点击选中单个元素，框选选中多个元素，支持Shift多选
│   │   │                   # 样式：选中元素周围显示高亮边框，多选时显示选择框，采用dify的蓝色
│   │   ├── minimap.py      # 小地图，位于画布右下角，显示整个工作流概览
│   │   │                   # 功能：提供工作流的缩略图视图，辅助导航和定位
│   │   │                   # 原型设计：缩略显示整个工作流，当前视图区域用矩形框标识
│   │   │                   # 样式：半透明背景，节点以简化形式显示，可拖动视图框快速导航
│   │   └── history.py      # 操作历史记录，支持撤销和重做功能
│   │                       # 功能：记录用户操作历史，支持撤销/重做，保障操作安全性
│   │                       # 原型设计：记录所有操作，支持撤销/重做，显示操作描述和时间
│   │                       # 样式：历史记录以时间线形式展示，当前状态明显标识，可展开查看详情
│   ├── dag/                # 有向无环图
│   │   ├── graph.py        # 图
│   │   │                   # 功能：实现工作流的核心数据结构，管理节点和连线的关系
│   │   │                   # 设计：采用有向无环图模型，支持节点依赖分析和拓扑排序
│   │   ├── node.py         # 节点
│   │   │                   # 功能：定义工作流节点的基本结构和行为，是工作流的基本组成单元
│   │   │                   # 原型设计：定义节点的基本结构，包含标题栏、内容区、端口区等；继承基类实现不同功能节点，如输入节点、输出节点、处理节点等
│   │   │                   # 样式：节点采用圆角矩形设计，有轻微阴影，标题栏颜色根据节点类型区分；不同类型节点采用不同配色方案，图标直观表示功能类型
│   │   ├── edge.py         # 边缘组件，包含端口和连线功能
│   │   │                   # 功能：实现节点间的连接，表示数据流动路径，包含端口定义和连线逻辑
│   │   │                   # 原型设计：输入端口位于节点左侧，输出端口位于右侧，显示数据类型和名称；贝塞尔曲线连接端口，箭头指示数据流向
│   │   │                   # 样式：端口采用半圆形设计，颜色根据数据类型区分；不同类型连线采用不同线型（实线、虚线等），数据流动时有动画效果
│   │   ├── config_panel.py # 配置面板，位于应用右侧，显示选中节点的配置选项
│   │   │                   # 功能：提供节点参数配置界面，实时更新节点属性
│   │   │                   # 原型设计：以选项卡形式展示不同配置区域，表单布局，实时保存修改
│   │   │                   # 样式：配置面板采用卡片式设计，重要参数突出显示，配有说明和示例
│   │   ├── context_menu.py # 右键菜单，提供节点上下文操作
│   │   │                   # 功能：提供节点相关的上下文操作，如删除、复制、重命名等
│   │   │                   # 原型设计：右击节点显示菜单，包含删除、复制、重命名等选项
│   │   │                   # 样式：菜单项带有图标和快捷键提示，常用操作位于顶部，危险操作需确认
│   │   └── drag_drop.py    # 拖放操作，实现从侧边栏到画布的节点拖放
│   │   │                   # 功能：处理节点从面板到画布的拖放创建过程
│   │   │                   # 原型设计：从节点面板拖动到画布，显示半透明预览，支持批量拖放
│   │   │                   # 样式：拖动时节点呈半透明状态，放置位置有对齐辅助线，成功放置有轻微动画
│   │   ├── execution.py    # 执行控制面板，提供执行、暂停、重置等功能
│   │                       # 功能：控制工作流的执行过程，提供执行状态监控和控制
│   │                       # 原型设计：包含执行按钮、批次设置、重置按钮等控件
│   │                       # 样式：控制按钮采用圆形设计，执行按钮为绿色，暂停为黄色，重置为灰色








